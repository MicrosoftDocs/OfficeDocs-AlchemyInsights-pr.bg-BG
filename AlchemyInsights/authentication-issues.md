---
title: Проблеми с удостоверяването
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: 53bd0d8f8edaead519d0282239d3a6d338b297b9
ms.sourcegitcommit: 029c4697b77ce996d41ca74c4fa86de1bb84bd99
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 01/25/2021
ms.locfileid: "49974190"
---
# <a name="authentication-issues"></a>Проблеми с удостоверяването

**Търсите информация за кодовете на грешки на AADSTS, върнати от услугата за маркери за защита на Azure Active Directory (Azure AD) (СТС)?** Вижте [кодовете на грешка за удостоверяване на AZURE ad и упълномощаване](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes) , за да намерите описания на грешки на AADSTS, корекции и някои предложени заобиколни решения.

Грешките при удостоверяване могат да се дължат на няколко различни проблема, като повечето от тях генерират грешка 401 или 403. Например следните проблеми могат да доведат до грешки при удостоверяване:

- Грешен [поток за придобиване на маркер за достъп](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization) 
- Лошо конфигурирани [обхвати на разрешения](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent) 
- Липса на [съгласие](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

За да коригирате често срещани грешки при удостоверяване, изпробвайте стъпките по-долу, които отговарят най-добре на грешката, която получавате. За грешка, която получавате, може да се приложи повече от една стъпка.

- **неоторизирана грешка 401: маркерът ви валиден ли е?**

Уверете се, че вашето приложение представя валиден маркер за достъп до Microsoft Graph като част от искането. Тази грешка често означава, че маркерът за достъп може да липсва в заглавката на заявката за удостоверяване на HTTP или че маркерът е невалиден или е изтекъл. Настоятелно ви препоръчваме да използвате библиотеката за удостоверяване на Microsoft (MSAL) за придобиване на маркери за достъп. Освен това тази грешка може да възникне, ако се опитате да използвате делегиран маркер за достъп, предоставен за личен акаунт в Microsoft за достъп до API, който поддържа само служебни или учебни акаунти (организационни акаунти).

**403 забранена грешка: избрахте ли подходящия набор от разрешения?**

Уверете се, че сте поискали правилния набор от разрешения на базата на API на Microsoft Graph, което ви зове. Препоръчват се най-малко привилегировани разрешения във всички теми за справочен метод на Microsoft Graph API. Освен това тези разрешения трябва да бъдат дадени на приложението от потребител или администратор. Даването на разрешения обикновено се случва чрез страницата за съгласие или използването на ножа за регистрационни приложения на Azure Portal. От острието на **настройките** за приложението щракнете върху **необходими разрешения** и след това щракнете върху **даване на разрешения**. За повече информация вижте:

- [Разрешения на Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference) 
- [Разбиране на разрешенията и съгласието на Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**403 забранена грешка: дали вашето приложение е придобило маркер, за да съответства на избраните разрешения?**

Уверете се, че типовете разрешения, които са заявени или дадени, съответстват на типа на маркера за достъп, който приложението придобива. Може да поискате и да отдавате разрешения за приложенията, но използвате делегирани кодове на потока на данни за взаимодействие, вместо маркерите за поток на клиентските идентификационни или отказвате даване на делегирани разрешения, но използвате маркерите за потока на идентификационните данни на клиента вместо знаците за поток от делегиран код.

За повече информация относно придобиването на маркери вижте:

- [Получаване на достъп от името на потребители и делегирани разрешения](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD v 2.0-OAuth 2,0 код за удостоверяване](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [Получаване на достъп без потребител (услуга за Daemon) и разрешения за приложения](https://docs.microsoft.com/graph/auth-v2-service) 
- [Поток на идентификационни данни за клиент на Azure AD v 2.0 – OAuth 2,0](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**забранена грешка 403: нулиране на парола**

В момента няма разрешения за услугата на Daemon Services за услуги, които позволяват нулиране на потребителски пароли. Тези APIs се поддържат само с помощта на интерактивен делегиран програмен код с подписан администратор. За повече информация вижте [разрешения за Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference).

**403 е забранено: потребителят има ли достъп и дали има лиценз?**

За потоците делегиран код Microsoft Graph изчислява дали заявката е разрешена на базата на разрешенията, дадени на приложението, и разрешенията, които потребителят е подписал. Като цяло тази грешка показва, че потребителят не е привилегирован достатъчно, за да изпълни заявката **или** потребителят не е лицензиран за достъп до данните. Само потребители с необходимите разрешения или лицензи могат да направят заявката успешно.

**забраняване на 403: изберете ли правилния Ресурсен API?**

API Services като Microsoft Graph проверяват дали искането за *AUD* (аудитория) в получения маркер за достъп съвпада със стойността, която очаква за себе си, а ако не е, възниква грешка в 403. Често срещана грешка, която води до тази грешка, се опитва да използва маркер, придобит за API за Azure AD Graph, API на Outlook или API на SharePoint/OneDrive, за да се обадите на Microsoft Graph (или обратно). Уверете се, че ресурсът (или обхватът), на който приложението ви е придобил маркер за съвпада с API, на който се обажда приложението.

**400 Bad заявка или непозволени 403: потребителят спазва ли правилата за условен достъп на организацията си?**

Въз основа на правилата за условен достъп на организация (CA) потребителят, който има достъп до ресурсите на Microsoft Graph чрез приложението, може да бъде оспорен за допълнителна информация, която не е налична в маркера за достъп, който първоначално е придобил приложението. В този случай вашето приложение получава **400 с *interaction_required*** грешка по време на придобиването на маркер за достъп или **403 с грешка в *insufficient_claims*** , когато се обаждате на Microsoft Graph. И в двата случая отговорът на грешката съдържа допълнителна информация, която може да бъде представена в оторизираната крайна точка, за да оспори потребителя за допълнителна информация (например многофакторно удостоверяване или записване на устройство).

За повече информация относно условния достъп вижте:

- [Справяне с предизвикателствата при условен достъп с помощта на MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [Ръководство за програмисти за условен достъп за Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

**_Край на поддръжката за библиотеката за удостоверяване на Azure Active Directory (ADAL) и API за AZURE ad Graph (пад Graph)_* _

- Започвайки от 30 юни 2020, повече няма да добавяме нови функции към библиотеката за удостоверяване на Azure Active Directory (ADAL) и API на Azure AD Graph (пад Graph). Ще продължим да предоставяме техническа поддръжка и актуализации на защитата, но повече няма да предоставяме актуализации на функции.
- Започвайки от 30 юни 2022, ние ще сложим край на поддръжката за ADAL и пад Graph и повече няма да предоставяме техническа поддръжка и актуализации на защитата.
    - Приложенията, използващи ADAL за съществуващите версии на операционната система, ще продължат да работят след този час, но няма да получат техническа поддръжка или актуализация на защитата.
    - Приложенията, които използват пад Graph след този час, вече не могат да получават отговори от крайна точка на графиката в пад.

_ *ADALна миграция**

Препоръчваме ви да актуализирате до [библиотеката за удостоверяване на Microsoft (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview), която има най-новите функции и актуализации на защитата. Тази препоръка е в контекста на Microsoft, който мигрира приложенията си към MSAL в края на срока на поддръжката. Целта на мигрирането на приложения на Microsoft Apps към MSAL е да се гарантира, че приложенията се възползват от текущите подобрения в защитата и функциите на MSAL.

- [Прочетете ЧЗВ за ADAL](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [Научете повече за това как да мигрирате приложения на база платформа](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- Ако имате нужда от помощ, за да разберете кой от вашите приложения използва ADAL, ви препоръчваме да прегледате всички изходни кодове на вашите приложения и, ако е приложимо, да се свържете с всички независими доставчици на софтуер (ISV) или доставчик на приложения. Поддръжката на Microsoft може да ви предостави и списък с всички приложения, които не са на Microsoft ADAL, във вашия клиент.

**Преминаване към графиката в пад**

За приложенията, които използват пад Graph, следвайте нашите указания за [мигриране на приложенията на AZURE ad Graph към Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true).

- [Нашият контролен списък за мигриране предоставя първи стъпки](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist). 
- Вашият портал за регистрация на Azure App показва кои приложения използват пад Graph. Препоръчваме ви да прегледате всички изходни кодове на вашите приложения и ако е приложимо, да се свържете с всички доставчици на ISV или приложения. Поддръжката на Microsoft може да ви предостави и информация за използването на всички данни от пад в своя клиент.

 










